#!/usr/bin/env bash

# check_network() {
#     wget -q --spider http://google.com
#     return $?
# }

fetch_joke() {
    response=$(curl -s https://official-joke-api.appspot.com/random_joke)
    setup=$(echo "$response" | jq -r '.setup')
    punchline=$(echo "$response" | jq -r '.punchline')
    if [[ -n "$setup" && -n "$punchline" && "$setup" != "-" && "$punchline" != "-" ]]; then
        echo "$setup - $punchline"
    else
        echo ""
    fi
}

commit_msg="$1"

if [ -z "$commit_msg" ]; then
    if check_network; then
        commit_msg=$(fetch_joke)
    fi
    if [ -z "$commit_msg" ]; then
        commit_msg=$(date +"%Y-%m-%d %H:%M")
    fi
fi

git add --all
if git commit -a -m "$commit_msg"; then
    echo "Changes committed successfully"
else
    echo "No changes to commit or commit failed"
fi
git push

