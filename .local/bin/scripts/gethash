#!/usr/bin/env bash
# Exit when non-zero status
# Unset Variable -> exit error
# Stop on errored pipe | 
set -euo pipefail

# this is for getting the sha256 hash of local files in nixos since the fetch
# command doesn't work for local files
# Usage: gethash <file>

if [[ $# -ne 1 ]]; then
    echo "Usage: $0 <file>"
    exit 1
fi

file="$1"

if [[ ! -f "$file" ]]; then
    echo "Error: '$file' is not a file."
    exit 2
fi

hash=$(sha256sum "$file" | awk '{print $1}')

sri=$(nix --extra-experimental-features nix-command hash convert --hash-algo sha256 --to sri "$hash")

echo "$sri"
echo -n "$sri" | xclip -selection clipboard
